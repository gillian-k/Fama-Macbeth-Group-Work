<<<<<<< HEAD
---
title: "Fama Macbeth Replication"
author: "Gillian Kimundi, Dongho Kim and Ming Fan"
date: "2023-10-25"
output:
  html_document:
  number_sections: true
classoption: landscape  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)
```

```{r echo=F,include=FALSE}


library(tidyverse)
library(lubridate)
library(readxl)
library(RPostgres)
library(RSQLite)
library(dbplyr)
library(furrr)
library(slider)
library(purrr)
library(ggplot2)
library(slider)
library(readr)

```

```{r include=FALSE}
#PORTFOLIO DATA AND RISK FREE RATE 

################

stacked_data <- read_csv("stacked_data_cross_sectional_regression.csv")

################
temp <- tempfile(fileext = ".zip")
download.file("https://mba.tuck.dartmouth.edu/pages/faculty/ken.french/ftp/F-F_Research_Data_Factors_CSV.zip",temp)
temp1 <- unzip(temp, exdir = ".")

ff_3factors_monthly <- read.csv(temp1, skip=5, header = F) 
names(ff_3factors_monthly) <- c('dt', 'rmrf', 'smb', 'hml', 'rf')
unlink(temp)
unlink(temp1)
head(ff_3factors_monthly)

ff_3factors_mon <- ff_3factors_monthly |> 
  filter(nchar(dt) == 6) |> 
  mutate(yr = str_sub(dt,1,4), mon= str_sub(dt,-2,-1),  
         date = make_date(year= yr, month = mon, day = 01),
         mkt_excess = as.numeric(rmrf), smb = as.numeric(smb),
         hml = as.numeric(hml), rf = as.numeric(rf)) |> 
  select(c('date','mkt_excess','smb','hml','rf'))
ff_3factors_mon <- as_tibble(ff_3factors_mon)

ff_3factors_mon$date <- as.Date(ff_3factors_mon$date)
ff_3factors_mon$date <- ceiling_date(ff_3factors_mon$date, "month") - days(1)
ff_3factors_mon$year_month <- format(ff_3factors_mon$date, "%Y-%m")

risk_free<-ff_3factors_mon|>
  select(rf, year_month)|>
  mutate(rf=rf/100)

```


The relationship between risk and return in financial markets sets the tone for the two-parameter portfolio model. The testable implications of the model are that firstly, expected returns are linearly related to risk; second, the $\beta$ is a complete risk measure for any security $i$ and thirdly, market risk should bear a positive premium, such that higher risk is associated with a higher return.

This way, we have the following: $$
\begin{aligned}
& \text { C1 }(\text { linearity })-E\left(\widetilde{\gamma}_{2 t}\right)=0 . \\
& \text { C2 (no systematic effects of non- } \beta \text { risk })-E\left(\widetilde{\gamma}_{3 t}\right)=0 . \\
& \text { C3 }(\text { positive expected return-risk tradeoff })-E\left(\widetilde{\gamma}_{1 t}\right)=E\left(\widetilde{R}_{m t}\right)- \\
& E\left(\widetilde{R}_{0 t}\right)>0 .
\end{aligned}
$$

This replication exercise follows the Fama & Macbeth (1973) empirical methodology in testing the validity of the two parameter model. The results are as follows: In Table 1, we summarize the sample selection for different periods of analysis. In Table 2, we summarize key statistical results including estimated portfolio betas, related standard errors, non-beta risk (portfolio standard deviation of residuals for selected periods. In Table 3, the main results on the test of the major hypotheses outlined above are provided from portfolio data analysis. Finally in Table 4, we document and discuss the behaviour of the observed market risk premium and the estimated risk premium.
